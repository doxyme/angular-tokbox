/**
 * @license
 * lodash 3.10.1 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 * Build: `lodash exports="none" iife="var _;(function(){%output%; _ " include="groupBy,find,findLast,debounce,sortBy,indexOf" -p -o ./.tmp/lodash-custom.min.js`
 */
var _;!function(){function e(e,n){var r;e:{r=e.a;var t=n.a;if(r!==t){var o=null===r,i=r===re,u=r===r,s=null===t,c=t===re,a=t===t;if(r>t&&!s||!u||o&&!c&&a||i&&a){r=1;break e}if(r<t&&!o||!a||s&&!i&&u||c&&u){r=-1;break e}}r=0}return r||e.b-n.b}function n(e){return!!e&&"object"==typeof e}function r(){}function t(e,n){var r=-1,t=e.length;for(n||(n=Array(t));++r<t;)n[r]=e[r];return n}function o(e,n){for(var r=-1,t=e.length;++r<t&&!1!==n(e[r],r,e););return e}function i(e,n){for(var r=-1,t=e.length;++r<t;)if(n(e[r],r,e))return!0;return!1}function u(e,n){var r;if(null==n)r=e;else{r=gn(n);var t=e;t||(t={});for(var o=-1,i=r.length;++o<i;){var u=r[o];t[u]=n[u]}r=t}return r}function s(e,n,r){var t=typeof e;return"function"==t?n===re?e:S(e,n,r):null==e?Z:"object"==t?d(e):n===re?ne(e):b(e,n)}function c(e,n,r,i,s,a,f){var p;if(r&&(p=s?r(e,i,s):r(e)),p!==re)return p;if(!R(e))return e;if(i=mn(e)){if(p=E(e),!n)return t(e,p)}else{var h=Ne.call(e),v=h==ce;if(h!=le&&h!=te&&(!v||s))return ke[h]?D(e,h,n):s?e:{};if(Ie(e))return s?e:{};if(p=k(v?{}:e),!n)return u(p,e)}for(a||(a=[]),f||(f=[]),s=a.length;s--;)if(a[s]==e)return f[s];return a.push(e),f.push(p),(i?o:l)(e,function(t,o){p[o]=c(t,n,r,o,e,a,f)}),p}function a(e,n,r,t){var o;return r(e,function(e,r,i){if(n(e,r,i))return o=t?r:e,!1}),o}function l(e,n){return ln(e,n,gn)}function f(e,n,r){if(null!=e){e=H(e),r!==re&&r in e&&(n=[r]),r=0;for(var t=n.length;null!=e&&r<t;)e=H(e)[n[r++]];return r&&r==t?e:re}}function p(e,r,t,o,i,u){if(e===r)return!0;if(null==e||null==r||!R(e)&&!n(r))return e!==e&&r!==r;e:{var s=p,c=mn(e),a=mn(r),l=oe,f=oe;c||(l=Ne.call(e),l==te?l=le:l!=le&&(c=G(e))),a||(f=Ne.call(r),f==te?f=le:f!=le&&G(r));var h=l==le&&!Ie(e),a=f==le&&!Ie(r),f=l==f;if(!f||c||h){if(!o&&(l=h&&Ke.call(e,"__wrapped__"),a=a&&Ke.call(r,"__wrapped__"),l||a)){e=s(l?e.value():e,a?r.value():r,t,o,i,u);break e}if(f){for(i||(i=[]),u||(u=[]),l=i.length;l--;)if(i[l]==e){e=u[l]==r;break e}i.push(e),u.push(r),e=(c?$:C)(e,r,s,t,o,i,u),i.pop(),u.pop()}else e=!1}else e=T(e,r,l)}return e}function h(e,n,r){var t=n.length,o=t,i=!r;if(null==e)return!o;for(e=H(e);t--;){var u=n[t];if(i&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++t<o;){var u=n[t],s=u[0],c=e[s],a=u[1];if(i&&u[2]){if(c===re&&!(s in e))return!1}else if(u=r?r(c,a,s):re,u===re?!p(a,c,r,!0):!u)return!1}return!0}function v(e,n){var r=-1,t=q(e)?Array(e.length):[];return cn(e,function(e,o,i){t[++r]=n(e,o,i)}),t}function d(e){var n=x(e);if(1==n.length&&n[0][2]){var r=n[0][0],t=n[0][1];return function(e){return null!=e&&(e=H(e),e[r]===t&&(t!==re||r in e))}}return function(e){return h(e,n)}}function b(e,n){var r=mn(e),t=I(e)&&n===n&&!R(n),o=e+"";return e=F(e),function(i){if(null==i)return!1;var u=o;if(i=H(i),!(!r&&t||u in i)){if(1!=e.length){var u=e,s=0,c=-1,a=-1,l=u.length,s=null==s?0:+s||0;for(0>s&&(s=-s>l?0:l+s),c=c===re||c>l?l:+c||0,0>c&&(c+=l),l=s>c?0:c-s>>>0,s>>>=0,c=Array(l);++a<l;)c[a]=u[a+s];i=f(i,c)}if(null==i)return!1;u=W(e),i=H(i)}return i[u]===n?n!==re||u in i:p(n,i[u],re,!0)}}function m(e){return function(n){return null==n?re:H(n)[e]}}function g(e){var n=e+"";return e=F(e),function(r){return f(r,e,n)}}function y(e,n){var r=e.length;for(e.sort(n);r--;)e[r]=e[r].c;return e}function S(e,n,r){if("function"!=typeof e)return Z;if(n===re)return e;switch(r){case 1:return function(r){return e.call(n,r)};case 3:return function(r,t,o){return e.call(n,r,t,o)};case 4:return function(r,t,o,i){return e.call(n,r,t,o,i)};case 5:return function(r,t,o,i,u){return e.call(n,r,t,o,i,u)}}return function(){return e.apply(n,arguments)}}function O(e){var n=new ze(e.byteLength);return new Je(n).set(new Je(e)),n}function w(e,n){return function(r,t){var o=r?pn(r):0;if(!B(o))return e(r,t);for(var i=n?o:-1,u=H(r);(n?i--:++i<o)&&!1!==t(u[i],i,u););return r}}function j(e){return function(n,r,t){var o=H(n);t=t(n);for(var i=t.length,u=e?i:-1;e?u--:++u<i;){var s=t[u];if(!1===r(o[s],s,o))break}return n}}function A(e,n){return function(r,t,o){if(t=L(t,o,3),mn(r)){e:{o=r.length;for(var i=n?o:-1;n?i--:++i<o;)if(t(r[i],i,r)){t=i;break e}t=-1}return-1<t?r[t]:re}return a(r,t,e)}}function $(e,n,r,t,o,u,s){var c=-1,a=e.length,l=n.length;if(a!=l&&!(o&&l>a))return!1;for(;++c<a;){var f=e[c],l=n[c],p=t?t(o?l:f,o?f:l,c):re;if(p!==re){if(p)continue;return!1}if(o){if(!i(n,function(e){return f===e||r(f,e,t,o,u,s)}))return!1}else if(f!==l&&!r(f,l,t,o,u,s))return!1}return!0}function T(e,n,r){switch(r){case ie:case ue:return+e==+n;case se:return e.name==n.name&&e.message==n.message;case ae:return e!=+e?n!=+n:e==+n;case fe:case pe:return e==n+""}return!1}function C(e,n,r,t,o,i,u){var s=gn(e),c=s.length,a=gn(n).length;if(c!=a&&!o)return!1;for(a=c;a--;){var l=s[a];if(!(o?l in n:Ke.call(n,l)))return!1}for(var f=o;++a<c;){var l=s[a],p=e[l],h=n[l],v=t?t(o?h:p,o?p:h,l):re;if(v===re?!r(p,h,t,o,i,u):!v)return!1;f||(f="constructor"==l)}return!(!f&&(r=e.constructor,t=n.constructor,r!=t&&"constructor"in e&&"constructor"in n&&!("function"==typeof r&&r instanceof r&&"function"==typeof t&&t instanceof t)))}function L(e,n,t){var o=r.callback||X,o=o===X?s:o;return t?o(e,n,t):o}function x(e){e=Q(e);for(var n=e.length;n--;){var r,t=e[n];r=e[n][1],r=r===r&&!R(r),t[2]=r}return e}function P(e,n){var r=null==e?re:e[n];return z(r)?r:re}function E(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&Ke.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function k(e){return e=e.constructor,"function"==typeof e&&e instanceof e||(e=Object),new e}function D(e,n,r){var t=e.constructor;switch(n){case he:return O(e);case ie:case ue:return new t((+e));case ve:case de:case be:case me:case ge:case ye:case Se:case Oe:case we:return t instanceof t&&(t=on[n]),n=e.buffer,new t(r?O(n):n,e.byteOffset,e.length);case ae:case pe:return new t(e);case fe:var o=new t(e.source,Ce.exec(e));o.lastIndex=e.lastIndex}return o}function q(e){return null!=e&&B(pn(e))}function U(e,n){return e="number"==typeof e||xe.test(e)?+e:-1,n=null==n?tn:n,-1<e&&0==e%1&&e<n}function V(e,n,r){if(!R(r))return!1;var t=typeof n;return!!("number"==t?q(r)&&U(n,r.length):"string"==t&&n in r)&&(n=r[n],e===e?e===n:n!==n)}function I(e,n){var r=typeof e;return!!("string"==r&&Ae.test(e)||"number"==r)||!mn(e)&&(!je.test(e)||null!=n&&e in H(n))}function B(e){return"number"==typeof e&&-1<e&&0==e%1&&e<=tn}function M(e){for(var n=J(e),r=n.length,t=r&&e.length,o=!!t&&B(t)&&(mn(e)||K(e)||Y(e)),i=-1,u=[];++i<r;){var s=n[i];(o&&U(s,t)||Ke.call(e,s))&&u.push(s)}return u}function H(e){if(r.support.unindexedChars&&Y(e)){for(var n=-1,t=e.length,o=Object(e);++n<t;)o[n]=e.charAt(n);return o}return R(e)?e:Object(e)}function F(e){if(mn(e))return e;var n=[];return(null==e?"":e+"").replace($e,function(e,r,t,o){n.push(t?o.replace(Te,"$1"):r||e)}),n}function W(e){var n=e?e.length:0;return n?e[n-1]:re}function K(e){return n(e)&&q(e)&&Ke.call(e,"callee")&&!Ye.call(e,"callee")}function N(e){return R(e)&&Ne.call(e)==ce}function R(e){var n=typeof e;return!!e&&("object"==n||"function"==n)}function z(e){return null!=e&&(N(e)?Re.test(We.call(e)):n(e)&&(Ie(e)?Re:Le).test(e))}function Y(e){return"string"==typeof e||n(e)&&Ne.call(e)==pe}function G(e){return n(e)&&B(e.length)&&!!Ee[Ne.call(e)]}function J(e){if(null==e)return[];R(e)||(e=Object(e));for(var n=e.length,t=r.support,n=n&&B(n)&&(mn(e)||K(e)||Y(e))&&n||0,o=e.constructor,i=-1,o=N(o)&&o.prototype||He,u=o===e,s=Array(n),c=0<n,a=t.enumErrorProps&&(e===Me||e instanceof Error),l=t.enumPrototypes&&N(e);++i<n;)s[i]=i+"";for(var f in e)l&&"prototype"==f||a&&("message"==f||"name"==f)||c&&U(f,n)||"constructor"==f&&(u||!Ke.call(e,f))||s.push(f);if(t.nonEnumShadows&&e!==He)for(n=e===Fe?pe:e===Me?se:Ne.call(e),t=un[n]||un[le],n==le&&(o=He),n=Pe.length;n--;)f=Pe[n],i=t[f],u&&i||(i?!Ke.call(e,f):e[f]===o[f])||s.push(f);return s}function Q(e){e=H(e);for(var n=-1,r=gn(e),t=r.length,o=Array(t);++n<t;){var i=r[n];o[n]=[i,e[i]]}return o}function X(e,r,t){return t&&V(e,r,t)&&(r=re),n(e)?ee(e):s(e,r)}function Z(e){return e}function ee(e){return d(c(e,!0))}function ne(e){return I(e)?m(e):g(e)}var re,te="[object Arguments]",oe="[object Array]",ie="[object Boolean]",ue="[object Date]",se="[object Error]",ce="[object Function]",ae="[object Number]",le="[object Object]",fe="[object RegExp]",pe="[object String]",he="[object ArrayBuffer]",ve="[object Float32Array]",de="[object Float64Array]",be="[object Int8Array]",me="[object Int16Array]",ge="[object Int32Array]",ye="[object Uint8Array]",Se="[object Uint8ClampedArray]",Oe="[object Uint16Array]",we="[object Uint32Array]",je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,Ae=/^\w*$/,$e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Te=/\\(\\)?/g,Ce=/\w*$/,Le=/^\[object .+?Constructor\]$/,xe=/^\d+$/,Pe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Ee={};Ee[ve]=Ee[de]=Ee[be]=Ee[me]=Ee[ge]=Ee[ye]=Ee[Se]=Ee[Oe]=Ee[we]=!0,Ee[te]=Ee[oe]=Ee[he]=Ee[ie]=Ee[ue]=Ee[se]=Ee[ce]=Ee["[object Map]"]=Ee[ae]=Ee[le]=Ee[fe]=Ee["[object Set]"]=Ee[pe]=Ee["[object WeakMap]"]=!1;var ke={};ke[te]=ke[oe]=ke[he]=ke[ie]=ke[ue]=ke[ve]=ke[de]=ke[be]=ke[me]=ke[ge]=ke[ae]=ke[le]=ke[fe]=ke[pe]=ke[ye]=ke[Se]=ke[Oe]=ke[we]=!0,ke[se]=ke[ce]=ke["[object Map]"]=ke["[object Set]"]=ke["[object WeakMap]"]=!1;var De={"function":!0,object:!0},qe=De[typeof module]&&module&&!module.nodeType&&module,Ue=De[typeof self]&&self&&self.Object&&self,_e=De[typeof window]&&window&&window.Object&&window,Ve=De[typeof exports]&&exports&&!exports.nodeType&&exports&&qe&&"object"==typeof global&&global&&global.Object&&global||_e!==(this&&this.window)&&_e||Ue||this,Ie=function(){try{Object({toString:0}+"")}catch(e){return function(){return!1}}return function(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}}(),Be=Array.prototype,Me=Error.prototype,He=Object.prototype,Fe=String.prototype,We=Function.prototype.toString,Ke=He.hasOwnProperty,Ne=He.toString,Re=RegExp("^"+We.call(Ke).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ze=Ve.ArrayBuffer,Ye=He.propertyIsEnumerable,Ge=Be.splice,Je=Ve.Uint8Array,Qe=Math.floor,Xe=P(Array,"isArray"),Ze=P(Object,"keys"),en=Math.max,nn=Math.min,rn=P(Date,"now"),tn=9007199254740991,on={};on[ve]=Ve.Float32Array,on[de]=Ve.Float64Array,on[be]=Ve.Int8Array,on[me]=Ve.Int16Array,on[ge]=Ve.Int32Array,on[ye]=Je,on[Se]=Ve.Uint8ClampedArray,on[Oe]=Ve.Uint16Array,on[we]=Ve.Uint32Array;var un={};un[oe]=un[ue]=un[ae]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},un[ie]=un[pe]={constructor:!0,toString:!0,valueOf:!0},un[se]=un[ce]=un[fe]={constructor:!0,toString:!0},un[le]={constructor:!0},o(Pe,function(e){for(var n in un)if(Ke.call(un,n)){var r=un[n];r[e]=Ke.call(r,e)}});var sn=r.support={};!function(e){var n=function(){this.x=e},r={0:e,length:e},t=[];n.prototype={valueOf:e,y:e};for(var o in new n)t.push(o);sn.enumErrorProps=Ye.call(Me,"message")||Ye.call(Me,"name"),sn.enumPrototypes=Ye.call(n,"prototype"),sn.nonEnumShadows=!/valueOf/.test(t),sn.spliceObjects=(Ge.call(r,0,1),!r[0]),sn.unindexedChars="xx"!="x"[0]+Object("x")[0]}(1,0);var cn=w(l),an=w(function(e,n){return fn(e,n,gn)},!0),ln=j(),fn=j(!0),pn=m("length"),hn=A(cn),vn=A(an,!0),dn=function(e,n){return function(r,t,o){var i=n?n():{};if(t=L(t,o,3),mn(r)){o=-1;for(var u=r.length;++o<u;){var s=r[o];e(i,s,t(s,o,r),r)}}else cn(r,function(n,r,o){e(i,n,t(n,r,o),o)});return i}}(function(e,n,r){Ke.call(e,r)?e[r].push(n):e[r]=[n]}),bn=rn||function(){return(new Date).getTime()},mn=Xe||function(e){return n(e)&&B(e.length)&&Ne.call(e)==oe},gn=Ze?function(e){var n=null==e?re:e.constructor;return"function"==typeof n&&n.prototype===e||("function"==typeof e?r.support.enumPrototypes:q(e))?M(e):R(e)?Ze(e):[]}:M;r.callback=X,r.debounce=function(e,n,r){function t(n,r){r&&clearTimeout(r),c=p=h=re,n&&(v=bn(),a=e.apply(f,s),p||c||(s=f=re))}function o(){var e=n-(bn()-l);0>=e||e>n?t(h,c):p=setTimeout(o,e)}function i(){t(b,p)}function u(){if(s=arguments,l=bn(),f=this,h=b&&(p||!m),!1===d)var r=m&&!p;else{c||m||(v=l);var t=d-(l-v),u=0>=t||t>d;u?(c&&(c=clearTimeout(c)),v=l,a=e.apply(f,s)):c||(c=setTimeout(i,t))}return u&&p?p=clearTimeout(p):p||n===d||(p=setTimeout(o,n)),r&&(u=!0,a=e.apply(f,s)),!u||p||c||(s=f=re),a}var s,c,a,l,f,p,h,v=0,d=!1,b=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(n=0>n?0:+n||0,!0===r)var m=!0,b=!1;else R(r)&&(m=!!r.leading,d="maxWait"in r&&en(+r.maxWait||0,n),b="trailing"in r?!!r.trailing:b);return u.cancel=function(){p&&clearTimeout(p),c&&clearTimeout(c),v=0,c=p=h=re},u},r.groupBy=dn,r.keys=gn,r.keysIn=J,r.matches=ee,r.pairs=Q,r.property=ne,r.sortBy=function(n,r,t){if(null==n)return[];t&&V(n,r,t)&&(r=re);var o=-1;return r=L(r,t,3),n=v(n,function(e,n,t){return{a:r(e,n,t),b:++o,c:e}}),y(n,e)},r.iteratee=X,r.find=hn,r.findLast=vn,r.identity=Z,r.indexOf=function(e,n,r){var t=e?e.length:0;if(!t)return-1;if("number"==typeof r)r=0>r?en(t+r,0):r;else if(r){r=0;var o=e?e.length:r;if("number"==typeof n&&n===n&&2147483647>=o){for(;r<o;){var i=r+o>>>1,u=e[i];u<n&&null!==u?r=i+1:o=i}r=o}else{o=Z,r=o(n);for(var i=0,u=e?e.length:0,s=r!==r,c=null===r,a=r===re;i<u;){var l=Qe((i+u)/2),f=o(e[l]),p=f!==re,h=f===f;(s?h:c?h&&p&&null!=f:a?h&&p:null==f?0:f<r)?i=l+1:u=l}r=nn(u,4294967294)}return r<t&&(n===n?n===e[r]:e[r]!==e[r])?r:-1}e:if(t=r||0,n!==n)n:{for(n=e.length,t+=-1;++t<n;)if(r=e[t],r!==r){e=t;break n}e=-1}else{for(t-=1,r=e.length;++t<r;)if(e[t]===n){e=t;break e}e=-1}return e},r.isArguments=K,r.isArray=mn,r.isFunction=N,r.isNative=z,r.isObject=R,r.isString=Y,r.isTypedArray=G,r.last=W,r.now=bn,r.detect=hn,r.VERSION="3.10.1",_=r}(),/*!
 *  opentok-angular (https://github.com/aullman/OpenTok-Angular)
 *
 *  Angular module for OpenTok
 *
 *  @Author: Adam Ullman (http://github.com/aullman)
 *  @Copyright (c) 2014 Adam Ullman
 *  @License: Released under the MIT license (http://opensource.org/licenses/MIT)
 **/
angular.module("opentok",[]).constant("TB",window.OT).provider("OTConfig",function(){var e;return{setKey:function(n){e=n},$get:function(){return{apiKey:e}}}}).factory("OTSession",["TB","$rootScope","$q","OTConfig","$log",function(e,n,r,t,o){if(!t.apiKey)throw new Error("You need to specify api key");var i={streams:[],uniqueStreams:{camera:[],screen:[]},connections:[],subscribers:[],publisher:null,screensharePublisher:null,ui:{hasAudio:!0,hasVideo:!0},init:function(u,s){return this.session=e.initSession(t.apiKey,u),i.session.on({sessionConnected:function(e){o.debug("OTSession:sessionConnected",e),i.publisher&&i.session.publish(i.publisher)},streamCreated:function(e){o.debug("OTSession:streamCreated",e),i.streams.push(e.stream),i.uniqueStreams.screen=i.getUniqueStreams("screen"),i.uniqueStreams.camera=i.getUniqueStreams("camera"),n.$digest()},streamDestroyed:function(e){o.debug("OTSession:streamDestroyed",e),i.streams.splice(i.streams.indexOf(e.stream),1),i.uniqueStreams.screen.splice(i.uniqueStreams.screen.indexOf(e.stream),1),i.uniqueStreams.camera.splice(i.uniqueStreams.camera.indexOf(e.stream),1),i.uniqueStreams.screen=i.getUniqueStreams("screen"),i.uniqueStreams.camera=i.getUniqueStreams("camera"),n.$digest()},sessionDisconnected:function(e){o.debug("OTSession:sessionDisconnected",e),n.$apply(function(){i.streams.splice(0,i.streams.length),i.uniqueStreams.screen.splice(0,i.uniqueStreams.screen.length),i.uniqueStreams.camera.splice(0,i.uniqueStreams.camera.length),i.connections.splice(0,i.connections.length),i.resetPublishers(),i.off(),i.session=null})},connectionCreated:function(e){o.debug("OTSession:connectionCreated",e),i.connections.push(e.connection),n.$digest()},connectionDestroyed:function(e){o.debug("OTSession:connectionDestroyed",e),i.connections.splice(i.connections.indexOf(e.connection),1),n.$digest()}}),r(function(e,n){i.session.connect(s,function(r){return r?n(r):void e(i.session)})})},initPublisher:function(n,r,o){return e.initPublisher(t.apiKey,n,r,o)},isSessionConnected:function(){return this.session&&(this.session.connected||this.session.isConnected&&this.session.isConnected())},listen:function(e,n){Object.keys(e).forEach(function(r){i.session.on(r,function(t){e[r].call(n,t)})})},togglePublishersAudio:function(e){i.ui.hasAudio="boolean"==typeof e?e:!i.ui.hasAudio,i.publisher&&i.publisher.publishAudio(i.ui.hasAudio)},togglePublishersVideo:function(e){i.ui.hasVideo="boolean"==typeof e?e:!i.ui.hasVideo,i.publisher&&i.publisher.publishVideo(i.ui.hasVideo)},resetPublishers:function(){i.togglePublishersAudio(!0),i.togglePublishersVideo(!0)},getUniqueStreams:function(e){var n=_.groupBy(i.streams,"connection.id");return Object.keys(n).map(function(r){var t=n[r];return _.find(t,{videoType:e})}).filter(function(e){return!!e})},disconnect:function(){i.isSessionConnected()&&(i.publisher&&i.session.unpublish(i.publisher),i.session.disconnect())}};return window.OTSession=i,i}]).factory("OTDirectivesHelpers",[function(){return{volumeLevels:[{level:0,name:"volume-low"},{level:.3,name:"volume-medium"},{level:.85,name:"volume-high"}],getVolumeLevelChanges:function(){var e=null;return function(n){e=null===e||e<=n.audioLevel?n.audioLevel:.7*e+.3*n.audioLevel;var r=Math.log(e)/Math.LN10/1.5+1;return Math.min(Math.max(r,0),1)}},setVolumeLevelChanges:function(e,n){var r=this,t=this.volumeLevels.map(function(e){return e.name}).join(" ");e.removeClass(t);var o,i=this.getVolumeLevelChanges(),u=0,s=0;return function(c){if(u+=i(c),s++,30===s){var a=u/s;u=s=0;var l=_.findLast(r.volumeLevels,function(e){return a>=e.level});if(!l)return void console.log("!volume",{average:a,volumeLevels:r.volumeLevels});var f=l.name;n&&n(f),o!==f&&(o=f,e.removeClass(t),e.addClass(f))}}}}}]).directive("otLayout",["$window","$parse","TB","OTSession",function(e,n,r,t){return{restrict:"E",link:function(r,o,i){var u=n(i.props)(),s=e.initLayoutContainer(o[0],u),c=function(){s.layout(),r.$emit("otLayoutComplete")};r.$watch(function(){return o.children().length},c),e.addEventListener("resize",c),r.$on("otLayout",c);var a=function(){t.session.on("streamPropertyChanged",function(e){"videoDimensions"===e.changedProperty&&c()})};return t.session?a():void t.on("init",a)}}}]).directive("otPublisher",["$rootScope","OTSession","OTDirectivesHelpers",function(e,n,r){function t(n){var r;["accessAllowed","accessDenied","accessDialogClosed","accessDialogOpened"].forEach(function(t){n.on(t,function(){"accessDenied"===r&&"accessDialogOpened"===t||(r=t,e.$emit(t))})})}return{restrict:"E",scope:{props:"&"},link:function(o,i){var u=o.props()||{};u.width=u.width||i[0].offsetWidth,u.height=u.height||i[0].offsetHeight;var s=angular.element(i).children();o.publisher=n.initPublisher(i[0],u,function(n){n&&e.$emit("otPublisherError",n,o.publisher)}),angular.element(i).append(s),t(o.publisher),o.publisher.on("loaded",function(){o.publisher.on("audioLevelUpdated",r.setVolumeLevelChanges(i))}),o.$on("$destroy",function(){o.publisher.destroy(),n.publisher=o.publisher=null}),n.isSessionConnected()?n.session.publish(o.publisher):o.publisher.on("streamDestroyed",function(e){e.preventDefault()}),n.publisher=o.publisher}}}]).directive("otScreenPublisher",["$rootScope","OTSession","OTDirectivesHelpers",function(e,n,r){return{restrict:"E",scope:{props:"&"},link:function(t,o){var i,u=angular.extend({mirror:!1,audioSource:null,videoSource:"screen",maxResolution:{width:1280,height:720},width:o[0].offsetWidth,height:o[0].offsetHeight},t.props()||{}),s=angular.element(o).children();i=n.initPublisher(o[0],u,function(n){if(n)return e.$emit("otScreenPublisher:error",n)}),angular.element(o).append(s),t.$on("$destroy",function(){n.session?n.session.unpublish(i):i.destroy(),n.screensharePublisher=i=null}),n.publisher&&n.publisher.on("audioLevelUpdated",r.setVolumeLevelChanges(o)),n.isSessionConnected()&&n.session.publish(i),i.on("streamDestroyed",function(n){e.$emit("TB:screenPublisher:streamDestroyed",n)}),n.screensharePublisher=i}}}]).directive("otActiveCallerLayout",["OTDirectivesHelpers",function(e){return{restrict:"EA",link:function(n){var r,t=[],o=_.debounce(function(){r&&r.removeClass("ot-active");var e=_.sortBy(t,"score").pop();r=e&&e.element.addClass("ot-active"),t=[]},500);n.$on("subscriber:volumeLevel",function(n,r,i){var u=_.find(t,"element",r);u||(u={element:r,score:0},t.push(u));var s=e.volumeLevels;u.score+=_.indexOf(s,_.find(s,"name",i)),o()})}}}]).directive("otSubscriber",["$rootScope","OTSession","OTDirectivesHelpers",function(e,n,r){return{restrict:"E",scope:{stream:"=",props:"&"},link:function(t,o){o.addClass("ot-"+t.stream.videoType);var i=t.props()||{};i.width=i.width||o[0].offsetWidth,i.height=i.height||o[0].offsetHeight;var u=o.children(),s=n.session.subscribe(t.stream,o[0],i,function(e){e&&t.$emit("otSubscriberError",e,s)});s.on("loaded",function(){n.subscribers.push(s),e.$emit("otSubscriberCreated",s),t.$emit(t,"otLayout"),s.on("audioLevelUpdated",function(e){e.audioLevel<.1||t.$emit("subscriber:audioLevelUpdated",e)}),s.on("audioLevelUpdated",r.setVolumeLevelChanges(o,function(e){t.$emit("subscriber:volumeLevel",o,e)}))}),angular.element(o).append(u),t.$on("$destroy",function(){n.subscribers.splice(n.subscribers.indexOf(s),1),n.session&&n.session.unsubscribe(s)})}}}]);